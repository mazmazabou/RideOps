<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rider Console</title>
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/css/tabler.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/dist/tabler-icons.min.css">
  <link rel="stylesheet" href="/css/rideops-theme.css">
</head>
<body class="d-flex flex-column">
  <header class="navbar navbar-expand-md" data-bs-theme="dark" style="background: var(--tblr-primary);">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">
        <span id="rider-brand" style="font-size:1.1rem;">RideOps Rider</span>
      </a>
      <div class="d-flex align-items-center gap-2">
        <span id="user-info" class="d-flex gap-1"></span>
        <a href="#" class="text-white opacity-75" onclick="logout(); return false;" title="Logout"><i class="ti ti-logout"></i></a>
      </div>
    </div>
  </header>

  <div class="page-body">
    <div class="mobile-shell py-3">

      <!-- My Account -->
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h3 class="card-title m-0">My Account <span id="rider-account-summary" class="fw-normal text-secondary small ms-2"></span></h3>
          <button class="toggle-btn-slim" id="account-toggle" type="button" onclick="toggleSection('rider-account', this)">&#9656;</button>
        </div>
        <div class="card-body" id="rider-account" style="display:none;">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">USC ID (read-only)</label>
              <input type="text" class="form-control" id="profile-uscid" readonly>
            </div>
            <div class="col-md-6">
              <label class="form-label">USC Email (read-only)</label>
              <input type="email" class="form-control" id="profile-email" readonly>
            </div>
            <div class="col-md-6">
              <label class="form-label">Username (read-only)</label>
              <input type="text" class="form-control" id="profile-username" readonly>
            </div>
            <div class="col-md-6">
              <label class="form-label">Full Name</label>
              <input type="text" class="form-control" id="profile-name">
            </div>
            <div class="col-md-6">
              <label class="form-label">Phone</label>
              <input type="tel" class="form-control" id="profile-phone">
            </div>
          </div>
          <button class="btn btn-primary mt-3" id="profile-save">Save Changes</button>
          <div id="profile-message" class="small mt-2"></div>
          <hr>
          <h4 class="mt-3 mb-2">Change Password</h4>
          <div class="row g-3">
            <div class="col-md-4">
              <label class="form-label">Current Password</label>
              <input type="password" class="form-control" id="pw-current">
            </div>
            <div class="col-md-4">
              <label class="form-label">New Password (min 8 chars)</label>
              <input type="password" class="form-control" id="pw-new">
            </div>
            <div class="col-md-4">
              <label class="form-label">Confirm New Password</label>
              <input type="password" class="form-control" id="pw-confirm">
            </div>
          </div>
          <button class="btn btn-outline-secondary mt-3" id="pw-change-btn">Update Password</button>
          <div id="pw-message" class="small mt-2"></div>
        </div>
      </div>

      <!-- New Reservation -->
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h3 class="card-title m-0">New Reservation</h3>
          <button class="toggle-btn-slim" type="button" onclick="toggleSection('rider-request', this)">&#9662;</button>
        </div>
        <div class="card-body" id="rider-request">
          <p class="text-secondary small mb-3">Service hours: Monday–Friday, 8:00am–7:00pm. USC campus only.</p>
          <form id="ride-form">
            <div class="mb-3 d-flex gap-3">
              <label class="form-check">
                <input class="form-check-input" type="radio" name="ride-type" value="one-time" checked>
                <span class="form-check-label">One-time</span>
              </label>
              <label class="form-check">
                <input class="form-check-input" type="radio" name="ride-type" value="recurring">
                <span class="form-check-label">Recurring</span>
              </label>
            </div>
            <div class="row g-3">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Pickup Location</label>
                  <select class="form-select" id="pickup-location" required></select>
                </div>
                <div class="mb-3">
                  <label class="form-label text-secondary small">If other, type details</label>
                  <input type="text" class="form-control" id="pickup-note" placeholder="e.g. Front of VKC by the fountain">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Dropoff Location</label>
                  <select class="form-select" id="dropoff-location" required></select>
                </div>
                <div class="mb-3">
                  <label class="form-label text-secondary small">If other, type details</label>
                  <input type="text" class="form-control" id="dropoff-note" placeholder="e.g. Gate 2, near crosswalk">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3" id="requested-time-label">
                  <label class="form-label">Requested Time</label>
                  <input type="datetime-local" class="form-control" id="requested-time" required>
                  <div class="form-hint">Must be within 8:00–19:00, Mon–Fri.</div>
                </div>
                <div id="recurring-fields" style="display:none;">
                  <div class="mb-3">
                    <label class="form-label">Start Date</label>
                    <input type="date" class="form-control" id="recurring-start">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">End Date</label>
                    <input type="date" class="form-control" id="recurring-end">
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Time of Day</label>
                    <input type="time" class="form-control" id="recurring-time">
                  </div>
                  <div class="mb-2">
                    <label class="form-label">Days of week</label>
                    <div class="d-flex gap-3 flex-wrap" id="recurring-days">
                      <label class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" value="1"><span class="form-check-label">Mon</span>
                      </label>
                      <label class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" value="2"><span class="form-check-label">Tue</span>
                      </label>
                      <label class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" value="3"><span class="form-check-label">Wed</span>
                      </label>
                      <label class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" value="4"><span class="form-check-label">Thu</span>
                      </label>
                      <label class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" value="5"><span class="form-check-label">Fri</span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Phone (for driver contact)</label>
                  <input type="tel" class="form-control" id="rider-phone" placeholder="213-555-0123">
                </div>
                <div class="mb-3">
                  <label class="form-label">Notes</label>
                  <textarea class="form-control" id="notes" rows="3" placeholder="Accessibility needs, exact spot, etc."></textarea>
                </div>
              </div>
            </div>
            <button type="submit" class="btn btn-primary">Submit Request</button>
          </form>
          <div id="form-message" class="small mt-2"></div>
        </div>
      </div>

      <!-- My Requests -->
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h3 class="card-title m-0">My Requests
            <button type="button" class="btn btn-icon btn-sm btn-outline-secondary ms-2" onclick="toggleLegendPopover(event)" title="Status legend">
              <i class="ti ti-help"></i>
            </button>
          </h3>
          <button class="toggle-btn-slim" type="button" onclick="toggleSection('rider-requests-list', this)">&#9662;</button>
        </div>
        <div class="card-body" id="rider-requests-list">
          <div class="alert alert-info" id="legend-popover" style="display:none;">
            <div class="d-flex flex-column gap-2">
              <div class="d-flex align-items-center gap-2 small"><span class="badge badge-pending"><i class="ti ti-clock"></i> Pending</span> <span>Awaiting review</span></div>
              <div class="d-flex align-items-center gap-2 small"><span class="badge badge-approved"><i class="ti ti-circle-check"></i> Approved</span> <span>Awaiting driver</span></div>
              <div class="d-flex align-items-center gap-2 small"><span class="badge badge-scheduled"><i class="ti ti-calendar"></i> Scheduled</span> <span>Driver assigned</span></div>
              <div class="d-flex align-items-center gap-2 small"><span class="badge badge-driver_on_the_way"><i class="ti ti-car"></i> On The Way</span> <span>Driver coming</span></div>
              <div class="d-flex align-items-center gap-2 small"><span class="badge badge-driver_arrived_grace"><i class="ti ti-map-pin"></i> Driver Arrived</span> <span>Driver waiting at pickup</span></div>
              <div class="d-flex align-items-center gap-2 small"><span class="badge badge-completed"><i class="ti ti-circle-check"></i> Completed</span> <span>Done</span></div>
            </div>
          </div>
          <div id="my-rides"></div>
          <button class="btn btn-outline-secondary btn-sm mt-2" id="rider-history-toggle" type="button">View all history</button>
        </div>
      </div>

      <!-- My Recurring Rides -->
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h3 class="card-title m-0">My Recurring Rides</h3>
          <button class="toggle-btn-slim" type="button" onclick="toggleSection('rider-recurring', this)">&#9662;</button>
        </div>
        <div class="card-body" id="rider-recurring">
          <div id="my-recurring"></div>
        </div>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.4.0/dist/js/tabler.min.js"></script>
  <script src="/js/rideops-utils.js"></script>
  <script src="/demo-config.js"></script>
  <script src="/js/rider.js"></script>
</body>
</html>
