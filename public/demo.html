<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RideOps Demo</title>
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.2.0/dist/css/tabler.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@3.37.1/dist/tabler-icons.min.css">
  <link rel="stylesheet" href="/css/rideops-theme.css">
  <script src="/js/rideops-utils.js"></script>
  <style>
    body { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: var(--color-page-bg); }
    .demo-wrap { width: 100%; max-width: 480px; padding: 24px; }
    .demo-header { text-align: center; margin-bottom: 28px; }
    .demo-brand { display: flex; align-items: center; gap: 10px; justify-content: center; margin-bottom: 8px; }
    .demo-brand .ro-brand-icon { width: 40px; height: 40px; font-size: 14px; }
    .demo-brand-text { font-size: 22px; font-weight: 800; color: var(--color-text); }
    .demo-subtitle { font-size: 13px; color: var(--color-text-secondary); }
    .demo-row { display: flex; align-items: center; gap: 14px; padding: 14px 16px; cursor: pointer; transition: background 0.1s; }
    .demo-row:hover { background: var(--color-surface-hover); }
    .demo-row-icon { width: 44px; height: 44px; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .demo-row-icon i { font-size: 22px; }
    .demo-row-icon--office { background: rgba(99,102,241,0.1); color: #6366F1; }
    .demo-row-icon--driver { background: rgba(245,158,11,0.1); color: #F59E0B; }
    .demo-row-icon--rider { background: rgba(59,130,246,0.1); color: #3B82F6; }
    .demo-row-text { flex: 1; min-width: 0; }
    .demo-row-title { font-size: 14px; font-weight: 700; color: var(--color-text); }
    .demo-row-desc { font-size: 12px; color: var(--color-text-muted); margin-top: 2px; }
    .demo-row-chevron { color: var(--color-text-muted); font-size: 18px; flex-shrink: 0; }
    .demo-footer { text-align: center; margin-top: 24px; font-size: 12px; color: var(--color-text-muted); }
    .demo-footer a { color: var(--color-primary); text-decoration: none; font-weight: 600; }
    .demo-footer a:hover { text-decoration: underline; }
    /* Campus selector pills */
    .campus-selector { display: flex; gap: 6px; justify-content: center; flex-wrap: wrap; margin-bottom: 20px; }
    .campus-pill { padding: 6px 14px; border-radius: var(--radius-pill); font-size: 12px; font-weight: 600; cursor: pointer; border: 1.5px solid var(--color-border); background: var(--color-surface); color: var(--color-text-secondary); transition: all 0.15s; }
    .campus-pill:hover { border-color: var(--color-text-muted); color: var(--color-text); }
    .campus-pill.active { border-color: var(--color-primary); background: var(--color-primary); color: #fff; }
    .campus-pill .pill-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 5px; vertical-align: middle; }
  </style>
</head>
<body>
  <div class="demo-wrap">
    <div class="demo-header">
      <div class="demo-brand">
        <img src="/logoWithoutBackground.png" alt="RideOps" class="ro-brand-icon" style="object-fit:cover;" />
        <span class="demo-brand-text">RideOps</span>
      </div>
      <div class="demo-subtitle">Campus Transportation Management</div>
    </div>

    <div class="campus-selector" id="campus-selector">
      <button class="campus-pill active" onclick="selectCampus(this, '')" data-campus="">
        <span class="pill-dot" style="background:#4682B4;"></span>RideOps
      </button>
      <button class="campus-pill" onclick="goToOrg('usc')" data-campus="usc">
        <span class="pill-dot" style="background:#990000;"></span>USC
      </button>
      <button class="campus-pill" onclick="goToOrg('stanford')" data-campus="stanford">
        <span class="pill-dot" style="background:#8C1515;"></span>Stanford
      </button>
      <button class="campus-pill" onclick="goToOrg('ucla')" data-campus="ucla">
        <span class="pill-dot" style="background:#2774AE;"></span>UCLA
      </button>
      <button class="campus-pill" onclick="goToOrg('uci')" data-campus="uci">
        <span class="pill-dot" style="background:#0064A4;"></span>UCI
      </button>
    </div>
    <div style="text-align:center; font-size:11px; color:var(--color-text-muted); margin-bottom:12px;">Select a campus to go directly to their portal, or pick a role below for default RideOps.</div>

    <div class="strip-list">
      <div class="demo-row" onclick="loginAs('office', 'demo123', '/')">
        <div class="demo-row-icon demo-row-icon--office"><i class="ti ti-building"></i></div>
        <div class="demo-row-text">
          <div class="demo-row-title">Office Manager</div>
          <div class="demo-row-desc">Full admin access &mdash; dispatch, scheduling, analytics</div>
        </div>
        <i class="ti ti-chevron-right demo-row-chevron"></i>
      </div>
      <div class="demo-row" onclick="loginAs('alex', 'demo123', '/driver')">
        <div class="demo-row-icon demo-row-icon--driver"><i class="ti ti-steering-wheel"></i></div>
        <div class="demo-row-text">
          <div class="demo-row-title">Driver</div>
          <div class="demo-row-desc">Claim &amp; complete rides on the mobile console</div>
        </div>
        <i class="ti ti-chevron-right demo-row-chevron"></i>
      </div>
      <div class="demo-row" onclick="loginAs('casey', 'demo123', '/rider')">
        <div class="demo-row-icon demo-row-icon--rider"><i class="ti ti-wheelchair"></i></div>
        <div class="demo-row-text">
          <div class="demo-row-title">Rider</div>
          <div class="demo-row-desc">Request rides and track their status</div>
        </div>
        <i class="ti ti-chevron-right demo-row-chevron"></i>
      </div>
    </div>

    <div style="text-align:center; margin-top:18px; font-size:12px; color:var(--color-text-muted);">
      Previewing: <strong style="color:var(--color-text);" id="demo-org-name">RideOps</strong> <span id="demo-org-tagline">Accessible Campus Transportation</span>
    </div>

    <div class="demo-footer">
      Powered by <a href="https://ride-ops.com">RideOps</a> &middot; <a href="https://ride-ops.com/contact">Request a real demo</a>
    </div>
  </div>

  <script src="/campus-themes.js"></script>
  <script>
    // Load tenant config for demo page
    fetch('/api/tenant-config').then(function(r) { return r.ok ? r.json() : null; }).then(function(c) {
      if (!c) return;
      // Apply saved campus on page load
      restoreSavedCampus(c);
    }).catch(function() {});

    function selectCampus(el, campusKey) {
      // Update pill active states
      document.querySelectorAll('.campus-pill').forEach(function(p) { p.classList.remove('active'); });
      el.classList.add('active');

      // Store in sessionStorage
      try {
        if (campusKey) {
          sessionStorage.setItem('ro-demo-campus', campusKey);
        } else {
          sessionStorage.removeItem('ro-demo-campus');
        }
      } catch(e) {}

      // Update preview text and colors
      var nameEl = document.getElementById('demo-org-name');
      var taglineEl = document.getElementById('demo-org-tagline');
      var brandText = document.querySelector('.demo-brand-text');
      var root = document.documentElement;

      if (campusKey && typeof CAMPUS_THEMES !== 'undefined' && CAMPUS_THEMES[campusKey]) {
        var ct = CAMPUS_THEMES[campusKey];
        if (nameEl) nameEl.textContent = ct.orgName;
        if (taglineEl) taglineEl.textContent = ct.orgTagline;
        if (brandText) brandText.textContent = ct.orgShortName;
        root.style.setProperty('--color-primary', ct.primaryColor);
      } else {
        if (nameEl) nameEl.textContent = 'RideOps';
        if (taglineEl) taglineEl.textContent = 'Accessible Campus Transportation';
        if (brandText) brandText.textContent = 'RideOps';
        root.style.setProperty('--color-primary', '#4682B4');
      }
    }

    function restoreSavedCampus(serverConfig) {
      var saved = null;
      try { saved = sessionStorage.getItem('ro-demo-campus'); } catch(e) {}
      if (saved && typeof CAMPUS_THEMES !== 'undefined' && CAMPUS_THEMES[saved]) {
        var pill = document.querySelector('.campus-pill[data-campus="' + saved + '"]');
        if (pill) selectCampus(pill, saved);
      } else {
        // Use server config defaults
        var el = document.getElementById('demo-org-name');
        if (el) el.textContent = serverConfig.orgName || 'RideOps';
        var tl = document.getElementById('demo-org-tagline');
        if (tl) tl.textContent = serverConfig.orgTagline || 'Accessible Campus Transportation';
      }
    }

    function goToOrg(slug) {
      window.location.href = '/' + slug;
    }

    async function loginAs(username, password, redirectTo) {
      var rows = document.querySelectorAll('.demo-row');
      rows.forEach(function(r) { r.style.pointerEvents = 'none'; r.style.opacity = '0.6'; });
      try {
        var res = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username: username, password: password })
        });
        if (res.ok) {
          window.location.href = redirectTo;
        } else {
          var data = await res.json().catch(function() { return {}; });
          showToastNew(data.error || 'Login failed. Please try again.', 'error');
          rows.forEach(function(r) { r.style.pointerEvents = ''; r.style.opacity = ''; });
        }
      } catch (e) {
        showToastNew('Network error. Please try again.', 'error');
        rows.forEach(function(r) { r.style.pointerEvents = ''; r.style.opacity = ''; });
      }
    }
  </script>
</body>
</html>
